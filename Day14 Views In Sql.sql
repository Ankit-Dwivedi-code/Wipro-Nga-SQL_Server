create database day14DB;

use day14DB;

-- Create Students tableCREATE TABLE Students (    student_id INT PRIMARY KEY,    student_name VARCHAR(50),    email VARCHAR(50),    major VARCHAR(50),    enrollment_year INT);-- Create Courses tableCREATE TABLE Courses (    course_id INT PRIMARY KEY,    course_name VARCHAR(50),    credit_hours INT,    department VARCHAR(50));-- Create StudentCourses table for enrollmentCREATE TABLE StudentCourses (    enrollment_id INT PRIMARY KEY,    student_id INT,    course_id INT,    semester VARCHAR(20),    grade CHAR(2),    FOREIGN KEY (student_id) REFERENCES Students(student_id),    FOREIGN KEY (course_id) REFERENCES Courses(course_id));-- Insert sample dataINSERT INTO Students VALUES (1, 'John Doe', 'john@example.com', 'Computer Science', 2020),(2, 'Jane Smith', 'jane@example.com', 'Mathematics', 2021),(3, 'Mike Johnson', 'mike@example.com', 'Physics', 2020);INSERT INTO Courses VALUES(101, 'Database Systems', 3, 'CS'),(102, 'Calculus II', 4, 'MATH'),(103, 'Quantum Physics', 4, 'PHYSICS');INSERT INTO StudentCourses VALUES(1, 1, 101, 'Fall 2023', 'A'),(2, 1, 102, 'Spring 2024', 'B'),(3, 2, 102, 'Fall 2023', 'A'),(4, 3, 103, 'Spring 2024', 'B+');SELECT * FROM StudentCourses, Students, Courses;-- Creating a simple view CREATE VIEW CS_Student ASselect student_id, student_name, emailFROM StudentsWHERE major = 'Computer Science';SELECT * FROM CS_Student;-- Complex VIEW ( From multiple Table with Joins)CREATE VIEW dbo.StudentEnrollments AS SELECT s.student_name, c.course_name, sc.semester, sc.gradeFROM dbo.Students sINNER JOIN dbo.StudentCourses sc on s.student_id = sc.student_idINNER JOIN dbo.Courses c ON sc.course_id = c.course_id;SELECT * FROM dbo.StudentEnrollments;-- View which can do operations on tables-- Inserting new data in studentsCreate view dbo.InsertIntoStudentsASSELECT * FROM Students;INSERT INTO dbo.InsertIntoStudents VALUES(4, 'Sallu bhai', 'sallu@bhai.com', 'Driving', 2025);SELECT * FROM InsertIntoStudents;-- Query and modify VIEWSELECT TOP 100 * FROM dbo.CS_Student;SELECT * FROM dbo.StudentEnrollments WHERE grade = 'A';-- Updating data through a viewCREATE VIEW dbo.UpdateStudent AS 	UPDATE dbo.CS_Student	SET email = 'John_doe_unversity.edu'	WHERE student_id = 1;BEGIN TRANSACTION ;	UPDATE dbo.CS_Student	SET email = 'John_doe_unversity.edu'	WHERE student_id = 1;-- VERIFYING THE UPDATE OPERATIONSELECT * FROM dbo.CS_Student WHERE student_id = 1;ROLLBACK TRANSACTION -- Undoing the changes-- IRCTC servers, Instead of doing every small changes in my main system, we have views that works as data-- where we can make local changes and later on when they are permanent they are updated in main DB-- Limitation with Views: (Very Imp.)-- Attemting to update a complex view Using error handling (Will fail)BEGIN TRY	BEGIN TRANSACTION;		UPDATE dbo.StudentEnrollments		SET grade = 'A+'		WHERE student_name = 'John Doe' AND course_name = 'Database Systems';	COMMIT TRANSACTION;END TRYBEGIN CATCH 	ROLLBACK TRANSACTION;	PRINT 'ERROR OCCURED ...!!' + ERROR_MESSAGE();END CATCH;-- ALTERING A VIEW (Ms SQL uses CREATE or ALTER in newer version-- For older version, we need to DROP and CREATEIF EXISTS ( SELECT * FROM sys.views WHERE name = 'CS_Student' AND schema_id = SCHEMA_ID('dbo'))		DROP VIEW dbo.CS_Student;--Simple ViewCREATE VIEW CS_Student_New ASselect student_id, student_name, emailFROM StudentsWHERE major = 'Computer Science';SELECT * FROM CS_Student_New;-- View MwetaData in MS SQL -- Get view definitionSELECT OBJECT_DEFINITION(OBJECT_ID('DBO.CS_Student_New')) AS ViewDefinition;-- List all view in the databaseSELECT NAME AS ViewName, create_date, modify_dateFROM sys.viewsWHERE is_ms_shipped = 0ORDER BY create_date;